using System;
using System.IO;
using System.Linq;
using Fclp;

namespace VulnerabilityScanner
{

    public class ApplicationArguments
    {
        public string TargetDirectory { get; set; }
    }
    
    static class CommandLineTool
    {
        static FluentCommandLineParser<ApplicationArguments> ArgumentsSetup()
        {
            var parser = new FluentCommandLineParser<ApplicationArguments>();
            parser.Setup(arg => arg.TargetDirectory)
                .As('d', "dir")
                .WithDescription("Path to directory to scan (default is current)")
                .SetDefault($"{AppDomain.CurrentDomain.BaseDirectory}"); // default path is current
            parser.SetupHelp("h", "help")
                .Callback(text => Console.WriteLine("vscan - tool to scan all files" +
                                                    " in directory\nOptions:" + text));
            return parser;
        }
        
        static void Main(string[] args)
        {
            var parser = ArgumentsSetup();

            if (args.Length == 0)
            {
                parser.HelpOption.ShowHelp(parser.Options);
                return;
            }
            
            var res = parser.Parse(args);

            if (!res.HasErrors)
            {
                Scanner sc = new Scanner(parser.Object.TargetDirectory);
                sc.Run();
                Console.Write(sc.StringStatus());
            }
        }
    }
}